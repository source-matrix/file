<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocSearch Pro - Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</title>
    <style>
        /* ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===== */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --bg-light: #f8fafc;
            --bg-dark: #0f172a;
            --card-light: rgba(255, 255, 255, 0.7);
            --card-dark: rgba(30, 41, 59, 0.8);
            --text-light: #1e293b;
            --text-dark: #e2e8f0;
            --glass-light: rgba(255, 255, 255, 0.25);
            --glass-dark: rgba(255, 255, 255, 0.1);
            --shadow-light: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        body.light-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: var(--text-light);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            color: var(--text-dark);
        }

        /* ===== Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ===== */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        .shape1 { width: 300px; height: 300px; background: var(--primary); top: 10%; left: 10%; animation-delay: 0s; }
        .shape2 { width: 200px; height: 200px; background: var(--secondary); top: 60%; right: 10%; animation-delay: -5s; }
        .shape3 { width: 150px; height: 150px; background: var(--accent); bottom: 20%; left: 30%; animation-delay: -10s; }
        .shape4 { width: 250px; height: 250px; background: #f472b6; top: 30%; right: 30%; animation-delay: -15s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(50px, -50px) rotate(90deg) scale(1.1); }
            50% { transform: translate(-30px, 30px) rotate(180deg) scale(0.9); }
            75% { transform: translate(-50px, -30px) rotate(270deg) scale(1.05); }
        }

        /* ===== Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            margin-bottom: 30px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            animation: slideDown 0.8s ease-out;
        }

        .light-mode .header {
            background: var(--card-light);
            box-shadow: var(--shadow-light);
        }

        .dark-mode .header {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        @keyframes slideDown {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .logo-icon:hover {
            transform: rotateY(180deg);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-glass {
            backdrop-filter: blur(10px);
        }

        .light-mode .btn-glass {
            background: var(--glass-light);
            color: var(--text-light);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .dark-mode .btn-glass {
            background: var(--glass-dark);
            color: var(--text-dark);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-glass:hover {
            transform: translateY(-3px);
        }

        .theme-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ===== */
        .card {
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.8s ease-out;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .light-mode .card {
            background: var(--card-light);
            box-shadow: var(--shadow-light);
        }

        .dark-mode .card {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .card:hover {
            transform: translateY(-5px) rotateX(2deg);
        }

        @keyframes fadeInUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        /* ===== Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ===== */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper input,
        .input-wrapper textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .light-mode .input-wrapper input,
        .light-mode .input-wrapper textarea {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
        }

        .dark-mode .input-wrapper input,
        .dark-mode .input-wrapper textarea {
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-dark);
        }

        .input-wrapper input:focus,
        .input-wrapper textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .input-wrapper textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* ===== Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« ===== */
        .search-section {
            animation-delay: 0.2s;
        }

        .search-box {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-input-container {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input-container input {
            width: 100%;
            padding: 18px 25px 18px 55px;
            border: 2px solid transparent;
            border-radius: 15px;
            font-size: 1.1rem;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .light-mode .search-input-container input {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-light);
        }

        .dark-mode .search-input-container input {
            background: rgba(30, 41, 59, 0.9);
            color: var(--text-dark);
        }

        .search-input-container input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.3rem;
            opacity: 0.6;
        }

        .search-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .light-mode .checkbox-wrapper {
            background: rgba(255, 255, 255, 0.5);
        }

        .dark-mode .checkbox-wrapper {
            background: rgba(255, 255, 255, 0.1);
        }

        .checkbox-wrapper:hover {
            transform: scale(1.02);
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        /* ===== Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ===== */
        .replace-section {
            animation-delay: 0.4s;
        }

        .replace-box {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .replace-box {
                grid-template-columns: 1fr;
            }
        }

        /* ===== Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== */
        .content-section {
            animation-delay: 0.6s;
        }

        .file-upload-area {
            border: 3px dashed;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .light-mode .file-upload-area {
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-mode .file-upload-area {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(30, 41, 59, 0.3);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            transform: scale(1.01);
        }

        .file-upload-area.dragover {
            border-color: var(--accent);
            background: rgba(6, 182, 212, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        /* ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ===== */
        .files-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
            animation: slideIn 0.4s ease-out;
        }

        .light-mode .file-item {
            background: rgba(255, 255, 255, 0.6);
        }

        .dark-mode .file-item {
            background: rgba(30, 41, 59, 0.6);
        }

        .file-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        @keyframes slideIn {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .file-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .file-meta {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: scale(1.1);
        }

        /* ===== Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ===== */
        .results-section {
            animation-delay: 0.8s;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-count {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .results-count span {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .result-item {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
            border-right: 4px solid var(--primary);
        }

        .light-mode .result-item {
            background: rgba(255, 255, 255, 0.7);
        }

        .dark-mode .result-item {
            background: rgba(30, 41, 59, 0.7);
        }

        .result-item:hover {
            transform: translateX(-10px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.2);
        }

        .result-file-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-preview {
            padding: 15px;
            border-radius: 10px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .light-mode .result-preview {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .result-preview {
            background: rgba(255, 255, 255, 0.05);
        }

        .highlight {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.4), rgba(139, 92, 246, 0.4));
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .result-matches {
            margin-top: 10px;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* ===== Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .toast-info {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* ===== Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .light-mode .modal {
            background: var(--card-light);
        }

        .dark-mode .modal {
            background: var(--card-dark);
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .light-mode .modal-close {
            background: rgba(0, 0, 0, 0.1);
            color: var(--text-light);
        }

        .dark-mode .modal-close {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
        }

        .modal-close:hover {
            transform: rotate(90deg);
            background: var(--primary);
            color: white;
        }

        /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… ===== */
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .light-mode .progress-bar {
            background: rgba(0, 0, 0, 0.1);
        }

        .dark-mode .progress-bar {
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.5s;
            width: 0%;
        }

        /* ===== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .light-mode .stat-card {
            background: rgba(255, 255, 255, 0.5);
        }

        .dark-mode .stat-card {
            background: rgba(30, 41, 59, 0.5);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* ===== ØªØ£Ø«ÙŠØ± Parallax Ù„Ù„ØªÙ…Ø±ÙŠØ± ===== */
        .parallax-element {
            transition: transform 0.1s ease-out;
        }

        /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ ===== */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 5px;
        }

        /* ===== Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ===== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .logo {
                font-size: 1.4rem;
            }

            .search-box {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-value {
                font-size: 1.8rem;
            }
        }

        /* ===== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± ===== */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .scroll-reveal.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        /* ===== Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·Ø© ===== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .light-mode .tab {
            background: rgba(255, 255, 255, 0.5);
        }

        .dark-mode .tab {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .tab:hover:not(.active) {
            transform: translateY(-2px);
        }

        /* ===== Ø§Ù„ÙÙˆØªØ± ===== */
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        /* ===== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ³Ø¹ ===== */
        .file-content-viewer {
            display: none;
            margin-top: 15px;
            padding: 20px;
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .light-mode .file-content-viewer {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .file-content-viewer {
            background: rgba(255, 255, 255, 0.05);
        }

        .file-content-viewer.show {
            display: block;
            animation: expandDown 0.3s ease-out;
        }

        @keyframes expandDown {
            from { max-height: 0; opacity: 0; }
            to { max-height: 300px; opacity: 1; }
        }

        /* ===== Ø²Ø± Ø§Ù„ØªÙˆØ³ÙŠØ¹ ===== */
        .expand-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
        }

        .expand-btn.expanded {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="light-mode">
    <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="bg-animation">
        <div class="floating-shape shape1"></div>
        <div class="floating-shape shape2"></div>
        <div class="floating-shape shape3"></div>
        <div class="floating-shape shape4"></div>
    </div>

    <div class="container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ“„</div>
                <span>DocSearch Pro</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-glass" onclick="exportData()">
                    <span>ğŸ’¾</span> ØªØµØ¯ÙŠØ±
                </button>
                <button class="btn btn-glass" onclick="document.getElementById('importInput').click()">
                    <span>ğŸ“¥</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯
                </button>
                <input type="file" id="importInput" accept=".json" style="display:none" onchange="importData(event)">
                <button class="btn btn-glass theme-toggle" onclick="toggleTheme()">
                    <span id="themeIcon">ğŸŒ™</span>
                </button>
            </div>
        </header>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid scroll-reveal">
            <div class="stat-card">
                <div class="stat-value" id="totalFiles">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalWords">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSearches">0</div>
                <div class="stat-label">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø«</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalReplacements">0</div>
                <div class="stat-label">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« -->
        <div class="card search-section scroll-reveal">
            <div class="card-title">
                <div class="card-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">ğŸ”</div>
                Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            </div>
            <div class="search-box">
                <div class="search-input-container">
                    <input type="text" id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡..." onkeyup="handleSearchKeyup(event)">
                    <span class="search-icon">ğŸ”</span>
                </div>
                <button class="btn btn-primary" onclick="performSearch()">
                    <span>ğŸ”</span> Ø¨Ø­Ø«
                </button>
            </div>
            <div class="search-options">
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="caseSensitive">
                    <span>Ø­Ø³Ø§Ø³ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="wholeWord">
                    <span>ÙƒÙ„Ù…Ø© ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø·</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="contextSearch" checked>
                    <span>Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ù‚</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="regexSearch">
                    <span>ØªØ¹Ø¨ÙŠØ± Ù…Ù†ØªØ¸Ù… (Regex)</span>
                </label>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ -->
        <div class="card replace-section scroll-reveal">
            <div class="card-title">
                <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">ğŸ”„</div>
                Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Øµ
            </div>
            <div class="replace-box">
                <div class="input-group">
                    <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ</label>
                    <div class="input-wrapper">
                        <input type="text" id="findText" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡...">
                    </div>
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                    <div class="input-wrapper">
                        <input type="text" id="replaceText" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø¯ÙŠÙ„...">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="performReplace()" style="margin-bottom: 20px;">
                    <span>âœ¨</span> Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ„
                </button>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
        <div class="card content-section scroll-reveal">
            <div class="card-title">
                <div class="card-icon" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">ğŸ“</div>
                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="switchTab('upload')">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª</div>
                <div class="tab" onclick="switchTab('manual')">âœï¸ Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©</div>
            </div>

            <div id="uploadTab">
                <div class="file-upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <span class="upload-icon">ğŸ“‚</span>
                    <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 10px;">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                    <p style="opacity: 0.7;">ÙŠØ¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù†ØµÙŠØ©ØŒ ØµÙˆØ±ØŒ PDFØŒ ÙˆØºÙŠØ±Ù‡Ø§)</p>
                </div>
                <input type="file" id="fileInput" multiple style="display:none" onchange="handleFileUpload(event)">
            </div>

            <div id="manualTab" style="display:none;">
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù / Ø§Ù„Ù‚Ø³Ù…</label>
                    <div class="input-wrapper">
                        <input type="text" id="fileName" placeholder="Ù…Ø«Ø§Ù„: document.txt">
                    </div>
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                    <div class="input-wrapper">
                        <textarea id="fileContent" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§..."></textarea>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addManualContent()">
                    <span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                </button>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
            <div class="files-list" id="filesList" style="margin-top: 25px;"></div>
        </div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
        <div class="card results-section scroll-reveal" id="resultsSection" style="display:none;">
            <div class="card-title">
                <div class="card-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2); color: white;">ğŸ“‹</div>
                Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
            </div>
            <div class="results-header">
                <div class="results-count">
                    ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <span id="resultsCount">0</span> Ù†ØªÙŠØ¬Ø© ÙÙŠ <span id="filesCount">0</span> Ù…Ù„Ù
                </div>
                <button class="btn btn-glass" onclick="downloadResults()">
                    <span>ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                </button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="searchProgress"></div>
            </div>
            <div id="resultsContainer"></div>
        </div>

        <!-- Ø§Ù„ÙÙˆØªØ± -->
        <footer class="footer">
            <p>DocSearch Pro - Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ğŸš€</p>
            <p style="margin-top: 10px;">ØµÙÙ†Ø¹ Ø¨Ù€ â¤ï¸ | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
        </footer>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <div class="modal-overlay" id="contentModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div id="modalContent" style="white-space: pre-wrap; line-height: 1.8;"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="editFileContent()">
                    <span>âœï¸</span> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="btn btn-glass" onclick="closeModal()">
                    <span>âœ–ï¸</span> Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="input-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</label>
                <div class="input-wrapper">
                    <input type="text" id="editFileName">
                </div>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                <div class="input-wrapper">
                    <textarea id="editFileContent" style="min-height: 200px;"></textarea>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="saveEditedFile()">
                    <span>ğŸ’¾</span> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                </button>
                <button class="btn btn-glass" onclick="closeEditModal()">
                    <span>âœ–ï¸</span> Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± -->
    <div class="toast" id="toast"></div>

    <script>
        /* ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ===== */
        let files = [];
        let searchCount = 0;
        let replaceCount = 0;
        let currentFileIndex = -1;

        /* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† LocalStorage ===== */
        function loadFromStorage() {
            const savedFiles = localStorage.getItem('docSearchFiles');
            const savedStats = localStorage.getItem('docSearchStats');
            const savedTheme = localStorage.getItem('docSearchTheme');

            if (savedFiles) {
                files = JSON.parse(savedFiles);
            }

            if (savedStats) {
                const stats = JSON.parse(savedStats);
                searchCount = stats.searches || 0;
                replaceCount = stats.replacements || 0;
            }

            if (savedTheme === 'dark') {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = 'â˜€ï¸';
            }

            updateUI();
        }

        /* ===== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ LocalStorage ===== */
        function saveToStorage() {
            localStorage.setItem('docSearchFiles', JSON.stringify(files));
            localStorage.setItem('docSearchStats', JSON.stringify({
                searches: searchCount,
                replacements: replaceCount
            }));
        }

        /* ===== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ===== */
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                icon.textContent = 'â˜€ï¸';
                localStorage.setItem('docSearchTheme', 'dark');
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                icon.textContent = 'ğŸŒ™';
                localStorage.setItem('docSearchTheme', 'light');
            }
        }

        /* ===== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ===== */
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'upload') {
                tabs[0].classList.add('active');
                document.getElementById('uploadTab').style.display = 'block';
                document.getElementById('manualTab').style.display = 'none';
            } else {
                tabs[1].classList.add('active');
                document.getElementById('uploadTab').style.display = 'none';
                document.getElementById('manualTab').style.display = 'block';
            }
        }

        /* ===== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù (Ù†ØµÙŠ Ø£Ù… Ø«Ù†Ø§Ø¦ÙŠ) ===== */
        function isTextFile(file) {
            const textTypes = [
                'text/', 'application/json', 'application/javascript', 'application/xml',
                'application/xhtml+xml', 'application/x-httpd-php', 'application/x-sh',
                'application/x-python', 'application/sql'
            ];
            const textExtensions = [
                'txt', 'json', 'html', 'htm', 'css', 'js', 'jsx', 'ts', 'tsx', 'md', 'markdown',
                'xml', 'csv', 'yaml', 'yml', 'ini', 'cfg', 'conf', 'log', 'sql', 'sh', 'bash',
                'py', 'php', 'rb', 'java', 'c', 'cpp', 'h', 'hpp', 'cs', 'go', 'rs', 'swift',
                'kt', 'scala', 'r', 'pl', 'pm', 'lua', 'vim', 'gitignore', 'env', 'htaccess',
                'bat', 'cmd', 'ps1', 'dockerfile', 'makefile', 'gradle', 'properties', 'toml'
            ];
            
            const ext = file.name.split('.').pop().toLowerCase();
            const mimeType = file.type || '';
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† MIME type
            if (textTypes.some(t => mimeType.startsWith(t))) return true;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯
            if (textExtensions.includes(ext)) return true;
            
            // Ù…Ù„ÙØ§Øª Ø¨Ø¯ÙˆÙ† Ø§Ù…ØªØ¯Ø§Ø¯ Ø£Ùˆ MIME type ÙØ§Ø±Øº - Ù†Ø­Ø§ÙˆÙ„ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ ÙƒÙ†Øµ
            if (!ext || ext === file.name || mimeType === '') return true;
            
            return false;
        }

        /* ===== Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ===== */
        function handleFileUpload(event) {
            const uploadedFiles = event.target.files;
            Array.from(uploadedFiles).forEach(file => {
                processFile(file);
            });
            event.target.value = '';
        }

        /* ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù ===== */
        function processFile(file) {
            const reader = new FileReader();
            const isText = isTextFile(file);
            
            reader.onload = function(e) {
                const fileData = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    content: e.target.result,
                    size: file.size,
                    type: file.type || getFileType(file.name),
                    date: new Date().toLocaleString('ar-EG'),
                    isText: isText,
                    isBinary: !isText
                };
                
                // Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©ØŒ Ù†Ø­ÙØ¸ Ø§Ù„Ù€ base64
                if (!isText) {
                    fileData.base64 = e.target.result;
                    fileData.content = `[Ù…Ù„Ù Ø«Ù†Ø§Ø¦ÙŠ: ${file.name}]\nØ§Ù„Ø­Ø¬Ù…: ${formatFileSize(file.size)}\nØ§Ù„Ù†ÙˆØ¹: ${file.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
                }
                
                files.push(fileData);
                saveToStorage();
                updateUI();
                showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­: ' + file.name, 'success');
            };
            
            reader.onerror = function() {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + file.name, 'error');
            };
            
            if (isText) {
                reader.readAsText(file);
            } else {
                reader.readAsDataURL(file);
            }
        }

        /* ===== Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª ===== */
        const dropZone = document.getElementById('dropZone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const droppedFiles = e.dataTransfer.files;
            handleDroppedFiles(droppedFiles);
        });

        function handleDroppedFiles(droppedFiles) {
            Array.from(droppedFiles).forEach(file => {
                processFile(file);
            });
        }

        /* ===== Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ ÙŠØ¯ÙˆÙŠ ===== */
        function addManualContent() {
            const name = document.getElementById('fileName').value.trim();
            const content = document.getElementById('fileContent').value.trim();

            if (!name || !content) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }

            files.push({
                id: Date.now(),
                name: name,
                content: content,
                size: new Blob([content]).size,
                type: getFileType(name),
                date: new Date().toLocaleString('ar-EG')
            });

            document.getElementById('fileName').value = '';
            document.getElementById('fileContent').value = '';

            saveToStorage();
            updateUI();
            showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        /* ===== Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ===== */
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                // Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ©
                'txt': 'text/plain',
                'json': 'application/json',
                'html': 'text/html',
                'htm': 'text/html',
                'css': 'text/css',
                'js': 'application/javascript',
                'jsx': 'application/javascript',
                'ts': 'application/typescript',
                'tsx': 'application/typescript',
                'md': 'text/markdown',
                'xml': 'text/xml',
                'csv': 'text/csv',
                'yaml': 'text/yaml',
                'yml': 'text/yaml',
                'sql': 'application/sql',
                'py': 'text/x-python',
                'php': 'application/x-php',
                'rb': 'text/x-ruby',
                'java': 'text/x-java',
                'c': 'text/x-c',
                'cpp': 'text/x-cpp',
                'h': 'text/x-c',
                'cs': 'text/x-csharp',
                'go': 'text/x-go',
                'rs': 'text/x-rust',
                'swift': 'text/x-swift',
                'sh': 'text/x-shellscript',
                'bat': 'text/x-batch',
                'ps1': 'text/x-powershell',
                'log': 'text/plain',
                'ini': 'text/plain',
                'cfg': 'text/plain',
                'conf': 'text/plain',
                // Ù…Ù„ÙØ§Øª ØµÙˆØ±
                'jpg': 'image/jpeg',
                'jpeg': 'image/jpeg',
                'png': 'image/png',
                'gif': 'image/gif',
                'bmp': 'image/bmp',
                'webp': 'image/webp',
                'svg': 'image/svg+xml',
                'ico': 'image/x-icon',
                // Ù…Ù„ÙØ§Øª Ù…Ø³ØªÙ†Ø¯Ø§Øª
                'pdf': 'application/pdf',
                'doc': 'application/msword',
                'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'xls': 'application/vnd.ms-excel',
                'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'ppt': 'application/vnd.ms-powerpoint',
                'pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'odt': 'application/vnd.oasis.opendocument.text',
                'ods': 'application/vnd.oasis.opendocument.spreadsheet',
                'odp': 'application/vnd.oasis.opendocument.presentation',
                // Ù…Ù„ÙØ§Øª Ù…Ø¶ØºÙˆØ·Ø©
                'zip': 'application/zip',
                'rar': 'application/x-rar-compressed',
                '7z': 'application/x-7z-compressed',
                'tar': 'application/x-tar',
                'gz': 'application/gzip',
                // Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ©
                'mp3': 'audio/mpeg',
                'wav': 'audio/wav',
                'ogg': 'audio/ogg',
                'flac': 'audio/flac',
                'm4a': 'audio/mp4',
                // Ù…Ù„ÙØ§Øª ÙÙŠØ¯ÙŠÙˆ
                'mp4': 'video/mp4',
                'avi': 'video/x-msvideo',
                'mkv': 'video/x-matroska',
                'mov': 'video/quicktime',
                'wmv': 'video/x-ms-wmv',
                'webm': 'video/webm',
                // Ù…Ù„ÙØ§Øª Ø£Ø®Ø±Ù‰
                'exe': 'application/x-executable',
                'dll': 'application/x-msdownload',
                'apk': 'application/vnd.android.package-archive',
                'dmg': 'application/x-apple-diskimage',
                'iso': 'application/x-iso9660-image'
            };
            return types[ext] || 'application/octet-stream';
        }

        /* ===== Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù„Ù ===== */
        function getFileIcon(type, filename) {
            const ext = filename ? filename.split('.').pop().toLowerCase() : '';
            
            // Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ© ÙˆØ¨Ø±Ù…Ø¬ÙŠØ©
            if (type.includes('json')) return 'ğŸ“Š';
            if (type.includes('html')) return 'ğŸŒ';
            if (type.includes('css')) return 'ğŸ¨';
            if (type.includes('javascript') || type.includes('typescript')) return 'âš¡';
            if (type.includes('markdown')) return 'ğŸ“';
            if (type.includes('xml')) return 'ğŸ“°';
            if (type.includes('csv')) return 'ğŸ“ˆ';
            if (type.includes('python')) return 'ğŸ';
            if (type.includes('php')) return 'ğŸ˜';
            if (type.includes('java') && !type.includes('javascript')) return 'â˜•';
            if (type.includes('ruby')) return 'ğŸ’';
            if (type.includes('go')) return 'ğŸ”µ';
            if (type.includes('rust')) return 'ğŸ¦€';
            if (type.includes('swift')) return 'ğŸ';
            if (type.includes('shell') || type.includes('bash') || ext === 'sh') return 'ğŸ’»';
            if (type.includes('sql')) return 'ğŸ—ƒï¸';
            
            // ØµÙˆØ±
            if (type.includes('image')) return 'ğŸ–¼ï¸';
            
            // Ù…Ø³ØªÙ†Ø¯Ø§Øª
            if (type.includes('pdf')) return 'ğŸ“•';
            if (type.includes('word') || type.includes('document') || ext === 'doc' || ext === 'docx') return 'ğŸ“˜';
            if (type.includes('excel') || type.includes('spreadsheet') || ext === 'xls' || ext === 'xlsx') return 'ğŸ“—';
            if (type.includes('powerpoint') || type.includes('presentation') || ext === 'ppt' || ext === 'pptx') return 'ğŸ“™';
            
            // Ù…Ø¶ØºÙˆØ·Ø©
            if (type.includes('zip') || type.includes('rar') || type.includes('7z') || type.includes('tar') || type.includes('gzip')) return 'ğŸ“¦';
            
            // ØµÙˆØªÙŠØ©
            if (type.includes('audio')) return 'ğŸµ';
            
            // ÙÙŠØ¯ÙŠÙˆ
            if (type.includes('video')) return 'ğŸ¬';
            
            // ØªÙ†ÙÙŠØ°ÙŠØ©
            if (type.includes('executable') || type.includes('msdownload') || ext === 'exe' || ext === 'dll') return 'âš™ï¸';
            if (ext === 'apk') return 'ğŸ“±';
            if (ext === 'dmg' || ext === 'iso') return 'ğŸ’¿';
            
            return 'ğŸ“„';
        }

        /* ===== ØªÙ†Ø³ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ===== */
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' Ø¨Ø§ÙŠØª';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª';
            return (bytes / (1024 * 1024)).toFixed(2) + ' Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª';
        }

        /* ===== ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===== */
        function updateUI() {
            updateFilesList();
            updateStats();
        }

        /* ===== ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ===== */
        function updateFilesList() {
            const container = document.getElementById('filesList');
            
            if (files.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.6; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ø±ÙØ¹ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨Ø¯Ø¡.</p>';
                return;
            }

            container.innerHTML = files.map((file, index) => {
                const icon = getFileIcon(file.type, file.name);
                const isBinary = file.isBinary || false;
                const fileTypeLabel = isBinary ? '<span style="color: #f59e0b; font-size: 0.75rem; margin-right: 8px;">Ø«Ù†Ø§Ø¦ÙŠ</span>' : '<span style="color: #10b981; font-size: 0.75rem; margin-right: 8px;">Ù†ØµÙŠ</span>';
                
                let contentPreview = '';
                if (isBinary && file.type && file.type.startsWith('image/')) {
                    contentPreview = `<div class="file-content-viewer" id="content-${index}"><img src="${file.base64}" style="max-width: 100%; max-height: 250px; border-radius: 8px;"></div>`;
                } else if (isBinary) {
                    contentPreview = `<div class="file-content-viewer" id="content-${index}" style="text-align: center; padding: 30px;">
                        <span style="font-size: 3rem;">${icon}</span>
                        <p style="margin-top: 15px; opacity: 0.7;">Ù…Ù„Ù Ø«Ù†Ø§Ø¦ÙŠ - ${file.type || 'Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        <p style="opacity: 0.5; font-size: 0.9rem;">Ø§Ù„Ø­Ø¬Ù…: ${formatFileSize(file.size)}</p>
                    </div>`;
                } else {
                    contentPreview = `<div class="file-content-viewer" id="content-${index}">${escapeHtml(file.content.substring(0, 5000))}${file.content.length > 5000 ? '\n\n... [Ù…Ø­ØªÙˆÙ‰ Ù…Ù‚ØªØ·Ø¹]' : ''}</div>`;
                }
                
                return `
                <div class="file-item" style="animation-delay: ${index * 0.05}s">
                    <div class="file-info" onclick="toggleFileContent(${index})">
                        <div class="file-icon">${icon}</div>
                        <div>
                            <div class="file-name">${file.name} ${fileTypeLabel}</div>
                            <div class="file-meta">${formatFileSize(file.size)} â€¢ ${file.date}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-glass btn-icon" onclick="viewFile(${index})" title="Ø¹Ø±Ø¶">ğŸ‘ï¸</button>
                        <button class="btn btn-glass btn-icon" onclick="downloadFile(${index})" title="ØªØ­Ù…ÙŠÙ„">ğŸ“¥</button>
                        <button class="btn btn-danger btn-icon" onclick="deleteFile(${index})" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                    </div>
                </div>
                ${contentPreview}
            `}).join('');
        }

        /* ===== ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù ===== */
        function toggleFileContent(index) {
            const contentDiv = document.getElementById(`content-${index}`);
            contentDiv.classList.toggle('show');
        }

        /* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ù†Ø§ÙØ°Ø© ===== */
        function viewFile(index) {
            currentFileIndex = index;
            const file = files[index];
            document.getElementById('modalTitle').textContent = file.name;
            
            const modalContent = document.getElementById('modalContent');
            const editBtn = document.querySelector('#contentModal .btn-primary');
            
            if (file.isBinary) {
                if (file.type && file.type.startsWith('image/')) {
                    modalContent.innerHTML = `<div style="text-align: center;"><img src="${file.base64}" style="max-width: 100%; max-height: 60vh; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);"></div>`;
                } else if (file.type && file.type.startsWith('audio/')) {
                    modalContent.innerHTML = `<div style="text-align: center; padding: 30px;">
                        <span style="font-size: 4rem;">ğŸµ</span>
                        <p style="margin: 20px 0;">Ù…Ù„Ù ØµÙˆØªÙŠ</p>
                        <audio controls src="${file.base64}" style="width: 100%;"></audio>
                    </div>`;
                } else if (file.type && file.type.startsWith('video/')) {
                    modalContent.innerHTML = `<div style="text-align: center;">
                        <video controls src="${file.base64}" style="max-width: 100%; max-height: 60vh; border-radius: 12px;"></video>
                    </div>`;
                } else {
                    const icon = getFileIcon(file.type, file.name);
                    modalContent.innerHTML = `<div style="text-align: center; padding: 40px;">
                        <span style="font-size: 5rem;">${icon}</span>
                        <h3 style="margin: 20px 0;">Ù…Ù„Ù Ø«Ù†Ø§Ø¦ÙŠ</h3>
                        <p style="opacity: 0.7; margin-bottom: 10px;">Ø§Ù„Ù†ÙˆØ¹: ${file.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        <p style="opacity: 0.7;">Ø§Ù„Ø­Ø¬Ù…: ${formatFileSize(file.size)}</p>
                        <p style="margin-top: 20px; opacity: 0.5; font-size: 0.9rem;">Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¹Ø±Ø¶ ÙƒÙ†Øµ</p>
                    </div>`;
                }
                // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
                editBtn.style.display = 'none';
            } else {
                modalContent.textContent = file.content;
                editBtn.style.display = 'flex';
            }
            
            document.getElementById('contentModal').classList.add('show');
        }

        /* ===== ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù ===== */
        function editFileContent() {
            closeModal();
            const file = files[currentFileIndex];
            document.getElementById('editFileName').value = file.name;
            document.getElementById('editFileContent').value = file.content;
            document.getElementById('editModal').classList.add('show');
        }

        /* ===== Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø¯Ù„ ===== */
        function saveEditedFile() {
            const name = document.getElementById('editFileName').value.trim();
            const content = document.getElementById('editFileContent').value;

            if (!name) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù', 'error');
                return;
            }

            files[currentFileIndex].name = name;
            files[currentFileIndex].content = content;
            files[currentFileIndex].size = new Blob([content]).size;
            files[currentFileIndex].type = getFileType(name);

            saveToStorage();
            updateUI();
            closeEditModal();
            showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        /* ===== Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° ===== */
        function closeModal() {
            document.getElementById('contentModal').classList.remove('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        /* ===== ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ===== */
        function downloadFile(index) {
            const file = files[index];
            let url;
            
            if (file.isBinary && file.base64) {
                // Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ base64 Ù…Ø¨Ø§Ø´Ø±Ø©
                url = file.base64;
            } else {
                // Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ©
                const blob = new Blob([file.content], { type: file.type || 'text/plain;charset=utf-8' });
                url = URL.createObjectURL(blob);
            }
            
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            if (!file.isBinary) {
                URL.revokeObjectURL(url);
            }
            
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ' + file.name, 'info');
        }

        /* ===== Ø­Ø°Ù Ù…Ù„Ù ===== */
        function deleteFile(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ')) {
                files.splice(index, 1);
                saveToStorage();
                updateUI();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        /* ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== */
        function updateStats() {
            document.getElementById('totalFiles').textContent = files.length;
            
            let totalWords = 0;
            files.forEach(file => {
                totalWords += file.content.split(/\s+/).filter(w => w).length;
            });
            document.getElementById('totalWords').textContent = totalWords.toLocaleString('ar-EG');
            document.getElementById('totalSearches').textContent = searchCount.toLocaleString('ar-EG');
            document.getElementById('totalReplacements').textContent = replaceCount.toLocaleString('ar-EG');
        }

        /* ===== Ø§Ù„Ø¨Ø­Ø« ===== */
        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (!query) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'error');
                return;
            }

            if (files.length === 0) {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨Ø­Ø« ÙÙŠÙ‡Ø§', 'error');
                return;
            }

            const caseSensitive = document.getElementById('caseSensitive').checked;
            const wholeWord = document.getElementById('wholeWord').checked;
            const showContext = document.getElementById('contextSearch').checked;
            const useRegex = document.getElementById('regexSearch').checked;

            searchCount++;
            saveToStorage();
            updateStats();

            const resultsSection = document.getElementById('resultsSection');
            const resultsContainer = document.getElementById('resultsContainer');
            const progressBar = document.getElementById('searchProgress');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 30px;"><div class="loading-spinner" style="border-color: var(--primary); border-top-color: transparent; width: 40px; height: 40px;"></div><p style="margin-top: 15px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</p></div>';
            progressBar.style.width = '0%';

            setTimeout(() => {
                let results = [];
                let totalMatches = 0;

                files.forEach((file, fileIndex) => {
                    progressBar.style.width = ((fileIndex + 1) / files.length * 100) + '%';
                    
                    // ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ù†Ø¨Ø­Ø« ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø§Ø³Ù…)
                    if (file.isBinary) {
                        let searchQuery = query;
                        let flags = 'gi';
                        if (!caseSensitive) flags = 'g';
                        
                        if (!useRegex) {
                            searchQuery = escapeRegex(query);
                        }
                        
                        try {
                            const regex = new RegExp(searchQuery, caseSensitive ? 'g' : 'gi');
                            const nameMatches = file.name.match(regex);
                            
                            if (nameMatches && nameMatches.length > 0) {
                                totalMatches += nameMatches.length;
                                results.push({
                                    file: file,
                                    fileIndex: fileIndex,
                                    matchCount: nameMatches.length,
                                    previews: ['<em style="opacity: 0.7;">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ·Ø§Ø¨Ù‚ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ù…Ù„Ù Ø«Ù†Ø§Ø¦ÙŠ)</em>'],
                                    isBinaryMatch: true
                                });
                            }
                        } catch (e) {}
                        return;
                    }
                    
                    let searchQuery = query;
                    let content = file.content;
                    let flags = 'g';

                    if (!caseSensitive) {
                        flags += 'i';
                    }

                    if (wholeWord) {
                        searchQuery = `\\b${escapeRegex(query)}\\b`;
                    } else if (!useRegex) {
                        searchQuery = escapeRegex(query);
                    }

                    try {
                        const regex = new RegExp(searchQuery, flags);
                        const matches = content.match(regex);

                        if (matches && matches.length > 0) {
                            totalMatches += matches.length;
                            
                            let previews = [];
                            if (showContext) {
                                let match;
                                const searchRegex = new RegExp(searchQuery, flags);
                                while ((match = searchRegex.exec(content)) !== null) {
                                    const start = Math.max(0, match.index - 50);
                                    const end = Math.min(content.length, match.index + match[0].length + 50);
                                    let preview = content.substring(start, end);
                                    
                                    if (start > 0) preview = '...' + preview;
                                    if (end < content.length) preview = preview + '...';
                                    
                                    const highlightedPreview = preview.replace(
                                        new RegExp(searchQuery, flags),
                                        '<span class="highlight">$&</span>'
                                    );
                                    
                                    previews.push(highlightedPreview);
                                    
                                    if (previews.length >= 3) break;
                                }
                            }

                            results.push({
                                file: file,
                                fileIndex: fileIndex,
                                matchCount: matches.length,
                                previews: previews
                            });
                        }
                    } catch (e) {
                        console.error('Regex error:', e);
                    }
                });

                document.getElementById('resultsCount').textContent = totalMatches;
                document.getElementById('filesCount').textContent = results.length;

                if (results.length === 0) {
                    resultsContainer.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;"><span style="font-size: 3rem;">ğŸ”</span><p style="margin-top: 15px; font-size: 1.1rem;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</p></div>';
                } else {
                    resultsContainer.innerHTML = results.map((result, idx) => {
                        const icon = getFileIcon(result.file.type, result.file.name);
                        const isBinary = result.file.isBinary;
                        const typeLabel = isBinary ? '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; margin-right: 8px;">Ø«Ù†Ø§Ø¦ÙŠ</span>' : '';
                        
                        return `
                        <div class="result-item" style="animation-delay: ${idx * 0.05}s; ${isBinary ? 'border-right-color: #f59e0b;' : ''}" onclick="viewFile(${result.fileIndex})">
                            <div class="result-file-name">
                                <span>${icon}</span>
                                ${result.file.name}
                                ${typeLabel}
                                <span style="font-size: 0.85rem; opacity: 0.7; margin-right: auto;">${formatFileSize(result.file.size)}</span>
                            </div>
                            ${result.previews.length > 0 ? result.previews.map(p => `
                                <div class="result-preview">${p}</div>
                            `).join('') : ''}
                            <div class="result-matches">
                                ğŸ“Œ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ·Ø§Ø¨Ù‚Ø§Øª: <strong>${result.matchCount}</strong>
                            </div>
                        </div>
                    `}).join('');
                }

                showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${totalMatches} Ù†ØªÙŠØ¬Ø© ÙÙŠ ${results.length} Ù…Ù„Ù`, 'success');
            }, 500);
        }

        /* ===== Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ===== */
        function performReplace() {
            const findText = document.getElementById('findText').value;
            const replaceText = document.getElementById('replaceText').value;

            if (!findText) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡', 'error');
                return;
            }

            if (files.length === 0) {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„', 'error');
                return;
            }

            let totalReplacements = 0;
            let filesAffected = 0;
            let skippedBinary = 0;

            files.forEach(file => {
                // ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©
                if (file.isBinary) {
                    skippedBinary++;
                    return;
                }
                
                const regex = new RegExp(escapeRegex(findText), 'g');
                const matches = file.content.match(regex);
                
                if (matches) {
                    totalReplacements += matches.length;
                    filesAffected++;
                    file.content = file.content.replace(regex, replaceText);
                    file.size = new Blob([file.content]).size;
                }
            });

            if (totalReplacements > 0) {
                replaceCount += totalReplacements;
                saveToStorage();
                updateUI();
                let msg = `ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ${totalReplacements} ØªØ·Ø§Ø¨Ù‚ ÙÙŠ ${filesAffected} Ù…Ù„Ù`;
                if (skippedBinary > 0) {
                    msg += ` (ØªÙ… ØªØ®Ø·ÙŠ ${skippedBinary} Ù…Ù„Ù Ø«Ù†Ø§Ø¦ÙŠ)`;
                }
                showToast(msg, 'success');
                
                document.getElementById('findText').value = '';
                document.getElementById('replaceText').value = '';
            } else {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†ØµÙŠØ©', 'error');
            }
        }

        /* ===== ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ===== */
        function downloadAllFiles() {
            if (files.length === 0) {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„', 'error');
                return;
            }
            
            files.forEach((file, index) => {
                setTimeout(() => {
                    downloadFile(index);
                }, index * 300);
            });
            
            showToast(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ${files.length} Ù…Ù„Ù...`, 'info');
        }

        /* ===== ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ===== */
        function downloadResults() {
            const query = document.getElementById('searchInput').value;
            const resultsHtml = document.getElementById('resultsContainer').innerHTML;
            
            const content = `
Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"
ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«: ${new Date().toLocaleString('ar-EG')}
===================================

${resultsHtml.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim()}
            `;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `search-results-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...', 'info');
        }

        /* ===== ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
        function exportData() {
            const data = {
                files: files,
                stats: {
                    searches: searchCount,
                    replacements: replaceCount
                },
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `docsearch-backup-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        /* ===== Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.files && Array.isArray(data.files)) {
                        files = [...files, ...data.files];
                        if (data.stats) {
                            searchCount += data.stats.searches || 0;
                            replaceCount += data.stats.replacements || 0;
                        }
                        saveToStorage();
                        updateUI();
                        showToast('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    } else {
                        showToast('ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    }
                } catch (e) {
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        /* ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ===== */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast toast-' + type + ' show';
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        /* ===== ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ± ===== */
        function handleScroll() {
            const elements = document.querySelectorAll('.scroll-reveal');
            elements.forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.top < window.innerHeight - 100) {
                    el.classList.add('revealed');
                }
            });

            // ØªØ£Ø«ÙŠØ± Parallax
            const shapes = document.querySelectorAll('.floating-shape');
            const scrollY = window.scrollY;
            shapes.forEach((shape, index) => {
                const speed = (index + 1) * 0.05;
                shape.style.transform = `translateY(${scrollY * speed}px)`;
            });
        }

        /* ===== Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§ ===== */
        document.getElementById('contentModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditModal();
        });

        /* ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ===== */
        window.addEventListener('scroll', handleScroll);
        window.addEventListener('load', () => {
            loadFromStorage();
            handleScroll();
        });

        /* ===== Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ===== */
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + F Ù„Ù„Ø¨Ø­Ø«
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            // Escape Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
            if (e.key === 'Escape') {
                closeModal();
                closeEditModal();
            }
            
            // Ctrl/Cmd + H Ù„Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                document.getElementById('findText').focus();
            }
        });
    </script>
</body>
</html>
